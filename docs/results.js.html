<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: results.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: results.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* global google */
import $ from 'jquery'

// Opciones disponibles. Quejas ninguna!
const chartOptions = ['Tarta', 'Barras', 'Columnas', 'Donut']
let type = 'Tarta'

let heroVotes
let comicVotes
let totalHeroVotes
let totalComicVotes

/**
 * Píllame quiénes han sido votados
 */
function getVoted(mode) {
  const voted = []
  const votes = (mode === 'superheroes') ? heroVotes : comicVotes
  Object.values(votes.votos).map((vote) => {
    const newVote = vote.voto
    let found = false
    for (let i = 0; i &lt; voted.length; i += 1) {
      if (newVote === voted[i]) {
        found = true
      }
    }

    if (!found) {
      voted.push(newVote)
    }
  })
  return voted
}

/**
 * Refactorizado! Aún así feo como pegarle a un padre.
 */
function drawChart(mode) {
  const data = new google.visualization.DataTable()
  let votes
  let totalVotes
  if (mode === 'superheroes') {
    data.addColumn('string', 'Personaje')
    votes = heroVotes
    totalVotes = totalHeroVotes
  } else {
    data.addColumn('string', 'Comic')
    votes = comicVotes
    totalVotes = totalComicVotes
  }
  data.addColumn('number', 'Votos')

  let name
  let numVotes
  let arialabel = `Total de votos ${totalVotes}, `

  const voted = getVoted(mode)
  const numVoted = voted.length

  for (let i = 0; i &lt; numVoted; i += 1) {
    name = voted[i]
    numVotes = 0
    for (let j = 0; j &lt; totalVotes; j += 1) {
      if (name === votes.votos[j].voto) {
        numVotes += 1
      }
    }
    arialabel += `${name} ${numVotes} votos, `
    data.addRow([name, numVotes])
  }
  const chartMode = (mode === 'superheroes') ? 'chartHeroes' : 'chartComics'
  const title = (mode === 'superheroes') ? 'personajes' : 'comics'
  $(`#${chartMode}`).attr('aria-label', arialabel)
  const options = {
    title: `Votación de ${title}`,
    width: 400,
    height: 300,
    backgroundColor: 'transparent',
    legend: { textStyle: { color: 'ghostwhite' } },
    titleTextStyle: { color: 'ghostwhite' },
    hAxis: { textStyle: { color: 'ghostwhite' } },
    vAxis: { textStyle: { color: 'ghostwhite' } }
  }

  let chart
  switch (type) {
    case 'Tarta':
      chart = new google.visualization.PieChart(document.getElementById(chartMode))
      break
    case 'Barras':
      chart = new google.visualization.BarChart(document.getElementById(chartMode))
      break
    case 'Columnas':
      chart = new google.visualization.ColumnChart(document.getElementById(chartMode))
      break
    case 'Donut':
      options.pieHole = 0.4
      chart = new google.visualization.PieChart(document.getElementById(chartMode))
      break
    default:
      break
  }
  chart.draw(data, options)
}

/**
 * Simple y sencillo. Llama a drawChart onchange.
 */
function loadSelect() {
  chartOptions.map((option) => {
    $('#selectHeroChart').append(`&lt;option value="${option}">${option}&lt;/option>`)
    $('#selectComicChart').append(`&lt;option value="${option}">${option}&lt;/option>`)
  })
  $('#selectHeroChart').change(() => {
    type = $('#selectHeroChart').val()
    drawChart('superheroes')
  })
  $('#selectComicChart').change(() => {
    type = $('#selectComicChart').val()
    drawChart('comics')
  })
}

/**
 * La democracia de los frikis!
 */
function loadVotes() {
  if (Storage !== void(0)) {
    heroVotes = JSON.parse(localStorage.herovotes)
    comicVotes = JSON.parse(localStorage.comicvotes)
    totalHeroVotes = Object.keys(heroVotes.votos).length
    totalComicVotes = Object.keys(comicVotes.votos).length
  }
}

$(document).ready(() => {
  loadVotes()
  loadSelect()
  setTimeout(() => {
    google.charts.load('visualization', '1', { packages: ['corechart'] })
    // google.charts.setOnLoadCallback(drawChart)
  }, 200)
})
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#drawChart">drawChart</a></li><li><a href="global.html#getVoted">getVoted</a></li><li><a href="global.html#loadSelect">loadSelect</a></li><li><a href="global.html#loadVotes">loadVotes</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Feb 28 2018 21:04:00 GMT+0000 (Hora estándar GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
